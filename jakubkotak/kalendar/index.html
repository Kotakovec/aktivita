<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Týdenní kalendář</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
    }

    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      height: 100vh;
      width: 100%;
    }

    .day {
      border: 1px solid #333;
      padding: 10px;
      text-align: center;
      background: #111;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-size: 1.2em;
    }

    .day:hover {
      background: #222;
    }

    .day span {
      margin-top: 10px;
      font-size: 0.9em;
      color: #0f0;
    }

    #controlBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 14px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      z-index: 1000;
      text-decoration: underline;
    }

    .modal-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal {
      background: #222;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px #0f0;
      color: white;
      text-align: center;
    }

    .modal input[type="password"],
    .modal input[type="text"] {
      width: 100%;
      padding: 8px;
      margin: 15px 0;
      font-size: 1em;
      border-radius: 4px;
      border: none;
    }

    .modal button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 1em;
      border-radius: 5px;
      border: none;
      background-color: #333;
      color: white;
      cursor: pointer;
    }

    .modal button:hover {
      background-color: #0a0;
    }

    .modal .close-btn {
      background-color: #900;
    }

    .modal .close-btn:hover {
      background-color: #f00;
    }
  </style>
</head>
<body>

<button id="controlBtn">control</button>
<div id="calendar"></div>

<!-- Modal: Heslo -->
<div id="passwordModal" class="modal-bg">
  <div class="modal">
    <div>Zadej heslo:</div>
    <input type="password" id="passwordInput" autocomplete="off" />
    <div>
      <button id="passwordSubmit">Potvrdit</button>
      <button class="close-btn" onclick="closeModal()">Zavřít</button>
    </div>
    <div id="passwordError" style="color: #f55; margin-top:10px; display:none;">Špatné heslo!</div>
  </div>
</div>

<!-- Modal: Úprava dne -->
<div id="editModal" class="modal-bg">
  <div class="modal">
    <div id="editDayLabel">Den:</div>
    <input type="text" id="editValue" placeholder="Zadej text ke dni..." />
    <div>
      <button id="saveDay">Uložit</button>
      <button class="close-btn" onclick="closeEdit()">Zavřít</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB2GfCg7OQfw4QlO85Dk2js_zsr76gmiQc",
    authDomain: "status-d3164.firebaseapp.com",
    databaseURL: "https://status-d3164-default-rtdb.firebaseio.com",
    projectId: "status-d3164",
    storageBucket: "status-d3164.appspot.com",
    messagingSenderId: "889015018548",
    appId: "1:889015018548:web:eaae16ad4ac16545e69661"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const ref = db.ref("tyden");

  const dny = ["Pondělí", "Úterý", "Středa", "Čtvrtek", "Pátek", "Sobota", "Neděle"];
  const calendar = document.getElementById("calendar");
  let isAdmin = false;
  let selectedDay = null;

  const controlBtn = document.getElementById("controlBtn");
  const passwordModal = document.getElementById("passwordModal");
  const passwordInput = document.getElementById("passwordInput");
  const passwordSubmit = document.getElementById("passwordSubmit");
  const passwordError = document.getElementById("passwordError");
  const editModal = document.getElementById("editModal");
  const editValue = document.getElementById("editValue");
  const editDayLabel = document.getElementById("editDayLabel");
  const saveDayBtn = document.getElementById("saveDay");
  const adminPassword = "frconzole24";

  // Vykresli dny
  dny.forEach((den, index) => {
    const div = document.createElement("div");
    div.className = "day";
    div.id = "day-" + index;
    div.innerHTML = `<strong>${den}</strong><span></span>`;
    div.addEventListener("click", () => {
      if (!isAdmin) return;
      selectedDay = index;
      editDayLabel.textContent = den;
      editValue.value = div.querySelector("span").textContent;
      editModal.style.display = "flex";
    });
    calendar.appendChild(div);
  });

  // Načíst hodnoty z Firebase
  ref.on("value", (snap) => {
    const data = snap.val() || {};
    dny.forEach((_, i) => {
      const val = data[i] || "";
      document.querySelector(`#day-${i} span`).textContent = val;
    });
  });

  controlBtn.addEventListener("click", () => {
    if (isAdmin) return;
    passwordInput.value = "";
    passwordError.style.display = "none";
    passwordModal.style.display = "flex";
    passwordInput.focus();
  });

  passwordSubmit.addEventListener("click", () => {
    if (passwordInput.value === adminPassword) {
      isAdmin = true;
      passwordModal.style.display = "none";
    } else {
      passwordError.style.display = "block";
    }
  });

  passwordInput.addEventListener("keydown", e => {
    if (e.key === "Enter") passwordSubmit.click();
  });

  saveDayBtn.addEventListener("click", () => {
    const value = editValue.value.trim();
    ref.child(selectedDay).set(value);
    editModal.style.display = "none";
  });

  editValue.addEventListener("keydown", e => {
    if (e.key === "Enter") saveDayBtn.click();
  });

  function closeModal() {
    passwordModal.style.display = "none";
  }

  function closeEdit() {
    editModal.style.display = "none";
  }
</script>
</body>
</html>